name: 'Publish EDD SL Release'
description: 'Publishes a new EDD SL release.'
inputs:
  composer-install:
    description: 'Whether to install composer dependencies.'
    required: false
    default: 'true'
  config-file:
    description: 'Relative path to your configuration file.'
    required: false
    default: 'edd-sl-release.json'
outputs:
  release-config:
    description: 'Parsed release configuration.'
    value: ${{ steps.parse-config.ouputs.release-config }}
runs:
  using: 'composite'
  steps:
    # Create zip file and attach to release.
    - name: Create release zip
      id: create-zip
      uses: ashleyfae/action-build-release-zip@main
      with:
        composer-install: ${{ inputs.composer-install }}

    # Parse the release config.
    - name: Parse release config
      id: parse-config
      shell: bash
      run: |
        JSON=$(cat ./${{ inputs.config-file }})
        echo "::set-output name=release-config::${JSON//'%'/'%25'}"

    - name: Upload release
      env:
        RELEASE_URL: ${{ steps.parse-config.outputs.release-config.url }}
        RELEASE_VERSION: ${{ steps.parse-config.outputs.release-config.version }}
        PRE_RELEASE: ${{ github.event.repository.pre_release }
        RELEASE_ZIP: ${{ steps.create-zip.outputs.zip-path }}
        RELEASE_REQUIREMENTS: ${{ toJson(steps.parse-config.outputs.release-config.version || null) }}
      shell: bash
      run: ${{ github.action_path }}/release.sh
